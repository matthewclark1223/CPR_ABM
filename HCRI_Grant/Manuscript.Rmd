---
title: Causal attribution of agricultural expansion in a small island system using approximate Bayesian computation 
author:
- affiliation: Boise State University - Human Environment Systems
  name: Matt Clark
- affiliation: Max Planck Institute for Evolutionary Anthropology
  name: Jeffrey Andrews
- affiliation: Boise State University - Human Environment Systems
  name: Nicholas Kolarik
- affiliation: Community Forests Pemba
  name: Mbarouk Mussa Omar
- affiliation: Boise State University - Human Environment Systems
  name: Vicken Hillis
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    latex_engine: pdflatex
    template: ~/SmokeProject/MarkdownDocuments/MillerTemplate.tex
  word_document: default
bibliography: ./HCRIGrantPaper.bib
abstract: The extent and arrangement of land cover types on our planet directly affects biodiversity, carbon storage, water quality, and many other critical social and ecological conditions at virtually all scales. Given this critical importance of land cover, a key mandate for land system scientists is to understand drivers of change. Identifying causal drivers of change is challenging however, because land systems, such as small-scale agricultural communities, do not lend themselves well to controlled experimentation for logistical and ethical reasons. Even natural experiments in these systems can produce only limited causal inference as they often contain unobserved confounding drivers of land cover change and complex feedbacks between drivers and outcomes. Land system scientists commonly grapple with this complexity by using computer simulations to explicitly delineate hypothesized causal pathways that could have resulted in observed land cover change. Yet, land system science lacks a systematic method for comparing multiple hypothesized pathways and quantifying the probability that a given simulated causal process was in fact responsible for the patterns observed. Here we use a case study of agricultural expansion in Pemba, Tanzania to demonstrate how approximate Bayesian computation provides a straightforward solution to this methodological gap. Specifically, we pair an individual-based simulation of land cover change in Pemba with approximate Bayesian computation to probabilistically estimate the likelihood that observed deforestation from 2018 to 2021 was driven by soil degradation versus external market forces. Using this approach, we can show not only how well a specific hypothesized mechanism fits with empirical data on land cover change, but we also quantify the range of other mechanisms that could have reasonably produced the same outcome (i.e. equifinality). We argue that approximate Bayesian computation is particularly promising as a tool for causal inference for land system science given the wealth of data available in the satellite record. Thus, this paper is a first step toward a robust process for identifying the emergent landscape-level signatures of complex social-ecological mechanisms. 
fontsize: 12pt
link-citations: yes
keywords: Land system science, Individual-based modeling, Complex systems
header-includes:
- \usepackage{pdfpages}
- \usepackage[font={footnotesize}]{caption}
- \usepackage{bm}
---

```{r packages, include=FALSE, cache=FALSE, message=FALSE, warning=FALSE}
#
library(knitr)
library(rmarkdown)
library(bookdown)
library(formattable)
library(kableExtra)
library(dplyr)
library(magrittr)
library(prettydoc)
library(htmltools)
library(knitcitations)
library(devtools)
library(tidyverse)
library(scales)
library(extrafont)
```

```{r setup, include=FALSE, cache=TRUE, message = FALSE, warning=FALSE}
# Chunk options: see http://yihui.name/knitr/options/ ###

## Text results
#opts_chunk$set(echo = TRUE, warning = TRUE, message = TRUE, include = TRUE)

## Code decoration
#opts_chunk$set(tidy = TRUE, tidy.opts = list(blank = FALSE, width.cutoff = 60), highlight = TRUE)

## Caching code
knitr::opts_chunk$set(cache = 2, cache.path = "Cache/")

## Plots
#opts_chunk$set(fig.path = "Figures_MS/", dev=c('pdf', 'png'), dpi = 300)

## Locate figures as close as possible to requested position (=code)
knitr::opts_chunk$set(fig.pos = 'H')

setwd("C:/Users/Matt/Documents/Pemba_Project/HCRI_Grant")
```

# 1 - Introduction
The mosaic of land cover on the surface of our planet is a product of complex social-ecological dynamics that make up the complete land system [@turner_emergence_2007; @turner_land-useland-cover_2021]. Changes in Earth’s terrestrial surface have profound implications for ecosystem functioning and human wellbeing, and as such, are of critical importance to understand and predict [@steffen_global_2006]. A key challenge in understanding land cover change and designing effective policies is that there are often multiple plausible, and even interacting mechanisms that can cause a switch in land cover from one state to another [@lambin_land_2010]. For example, in the case of agricultural frontier expansion, depletion of soil fertility in existing plots often promotes the conversion of nearby natural vegetation to new cropland, thus pushing the frontier outward [@casetti_formalization_1977]. Agricultural frontier expansion into forested lands is also observed however, as a result of increased market value for crops and increased population pressure [@meyfroidt_middle-range_2018].  

When designing policies to limit the conversion of natural areas into more intensive land use types such as rotational agriculture, it is important to determine the drivers of conversion, because the impact of a given policy will depend on the dominant driver. The introduction of new agricultural technologies, for instance, can have drastically different effects on the landscape depending on the primary driver of frontier expansion in a given system [see Kaimowitz et al. -@kaimowitz_economic_1998 for a foundational review]. If loss of soil fertility is the primary driver, new technologies can limit forest conversion as they allow existing plots to be farmed for longer periods of time, minimizing the need for agricultural operations to change location. However, if market forces are the primary driver of frontier expansion, this same intervention is likely to incentivize forest conversion by increasing the returns from any given agricultural plot [@meyfroidt_middle-range_2018]. Despite the importance of identifying causal processes in land cover change, actually doing so in any particular case has often proven difficult given the inherent social-ecological complexity of land systems [@meyfroidt_approaches_2016; @turner_framing_2020]. 

Land systems are complex adaptive systems characterized by feedbacks between the human and ecological subsystems, where a change in the state of one affects ongoing processes in the other and vice versa [@berkes_linking_2000; @le_feedback_2012; @folke_socialecological_2007]. The possible distribution of land cover types in any one area is also highly path dependent, or constrained by past states and trajectories, sometimes further muddying the relationship between actual drivers and outcomes [@liu_complexity_2007]. Standard statistical tests fail to produce reliable inference in complex systems exhibiting feedbacks and path dependence, given that it is generally impossible to specify likelihood functions for such processes [@levin_social-ecological_2013]. Thus, while critical, identifying causal processes in land systems and social-ecological systems generally has proven difficult. 

To begin to build causal theory in complex land systems, researchers commonly use computer simulations to abstract key phenomena and produce ‘what-if’ scenarios [@ahimbisibwe_understanding_2021; @an_challenges_2021]. Simulations allow researchers to code complexities such as feedbacks and path dependence directly into a model of the processes under examination, in order to formally define a hypothesized causal mechanism and check the logical implications and internal validity of their assumptions [@epstein_why_2008; @verburg_simulating_2006; @schluter_toward_2019]. While simulations like this are important for theorizing about social-ecological systems, it can be difficult to relate them back to empirical data and tell where exactly the real-world sits in the multidimensional parameter space of the model [@ren_spatially_2019]. Without this information, we are limited in our knowledge of how well a given simulation accurately distills the processes we are hoping to examine, and how we might use such a model to infer important things about the real-world. 

Ecological research has made considerable use of simulation modeling to theorize about how complex interactions among individuals lead to observed patterns at the population level (i.e. individual-based modeling) [@grimm_ten_1999; @deangelis_individual-based_2014; @grimm_individual-based_2013]. Relatively early on in the use of individual-based modeling in ecology, researchers developed the general process of pattern-oriented modeling for relating observed patterns in ecological data to simulated hypothesized causal mechanisms [@wiegand_using_2003; @grimm_pattern-oriented_2005]. This method allowed researchers to match observed trends in population change with plausible rates for various demographic parameters such as pre-breeding survival in woodpeckers, road mortality in lynx, and annual male survival in amphibians, among many others [@rossmanith_pattern-oriented_2007; @kramer-schadt_fragmented_2004; @swanack_projecting_2009, @wiegand_using_2003]. This general method was a significant step toward the development of a systematic process for interrogating the hypothesized causal mechanisms built into computer simulations with observed data on emergent phenomena. 

More recently, approximate Bayesian computation (ABC) has emerged as a formal method of pattern-oriented modeling in which researchers run simulation models across many parameter values and systematically accept or reject the outputs of each run as consistent with observed data. All accepted parameter values are then aggregated into a probability distribution of parameter values that are likely to produce the observed data [@hartig_statistical_2011; @troost_how_2022]. ABC has proven effective for identifying the range of simulation model parameters consistent with observed data across a wide breadth of biological fields from ecology to epidemiology [@scranton_approximate_2014;@kosmala_estimating_2016; @van_der_vaart_predicting_2016; @boult_individual-based_2018; @martinez_disentangling_2011; @cipriotti_understanding_2012]. When differing simulation parameters coincide with specific hypothesized causal processes, ABC can then be used to estimate the probability that a given causal process produced a given set of observed data. Importantly, ABC enables researchers to statistically estimate model parameters even for generative models containing complex processes such as the feedbacks and path dependence characteristic of social-ecological systems [@gallagher_theory_2021]. 

In this paper we demonstrate the utility of ABC for generative inference in complex land systems and social-ecological systems generally. Specifically, we simulate hypothesized patterns of agricultural expansion in a small island system given two possible drivers, declining soil fertility and external market forces. We then filter the range of possible model parameters to just the inputs that produce land use patterns consistent with the observed time-series of agricultural frontier expansion. We show that this method allows us to determine the proportion of each of these drivers in causing the observed agricultural expansion in our study system, Pemba Island, Tanzania. Thus, this paper provides a straightforward demonstration for linking land system simulations with empirical data to draw causal inference in even very complex systems involving feedbacks and path dependence.


# 2 - Study system

## 2.1 - Pemba
The Indian Ocean archipelago of Zanzibar is a semi-autonomous jurisdiction lying off the coast of Tanzania. Pemba, the northernmost island, is densely populated with (XXX) people per square kilometer. While the island has a few main population centers (Wete, Chake Chake, and Mkoani), the vast majority of the island's 400,000 people live in small villages scattered across some 120 wards (shehia), all of which are connected by a dense, relatively modern road network (fig. 1). Based on the 2022 census, we estimate the average growth rate between 2012 and 2022 to be about 2.1% which is more than double the world average of 0.9% per year.

![Caption ](./PaperFigures/OverviewMap.png)

The rural economy of Pemba is primarily subsistence (farming, fishing, and livestock),
with a single important cash crop, cloves. Cloves were introduced to the island in the early 19th century and have come to dominate the economy of the island's western half due to the region's highly productive soils (see below). In contrast, the island's eastern side, characterized by poor, shallow soil, has lower human population density, is less developed, and is generally less economically productive. For example, in an extensive household survey focused on economic production carried out in 2017, we find that the average household income from the sale of crops (excluding cloves) in the east is approximately $25, compared with an estimated $80 in the highly productive western half. 

Nevertheless, there is considerable pressure in the east for new farmland. Some 30% of
All eastern households surveyed stated that they had cleared forested land to expand their farming operations in the past 7 years. On average, households report clearing approximately 0.91 acres, primarily to plant staple crops such as cassava. And while cassava is almost exclusively a subsistence crop in Pemba, there has been considerable pressure to develop the Pemban economy in the past decade, as it has lagged behind the rest of Tanzania and Zanzibar. New development initiatives, particularly in agriculture, are a constant of government programming, and new crops such as watermelon and tomatoes are being experimented with on the once underutilized eastern soils. However, Pemba has historically struggled to develop its own internal market for agricultural goods, and the impact that these new cash crops are having on the eastern landscape is unknown.



## 2.2 - Coral rag vegetation and rotational agriculture
Pemba is a narrow island, in many places just 15 kilometers wide, yet most of the environmental variation exists across the narrow east/west span. This is owed to three distinct soil types that run the length of the island and can generally be thought of as going from deep and fertile in the west, to shallow and nutrient poor in the east [@stockley_report_1928]. The easternmost topography is characterized by jagged, fossilized coral beds covered with a shallow soil layer and scrubby vegetation ranging from approximately 1 to 5 meters in height (i.e. coral rag forest) [@burgess_coastal_2000; @burrows_trees_2018]. This forest type has traditionally been overlooked by conservation efforts in Pemba, and Zanzibar generally, yet it is critical habitat for a variety of plant and animal species such as the endemic Pemba flying fox (*Pteropus voeltzkowi*) [@kingdon_east_1988].

![Caption ](./Photos/CoralRagCompositeReal.png)

The shallow soils atop porous coral rag geology characteristic to eastern Pemba cannot be productively farmed for long, continuous periods. Farmers in this region thus typically rely on rotational swidden agriculture where primary forest is cleared and the land is farmed for a short period, then left to recharge for a number of years (fig 2). While this process could potentially be interrupted by regenerative agricultural practices or the introduction of rainwater catchment systems, currently farmers in this region lack resources to escape the cycle of ecologically costly, short-term resource extraction [@leal_filho_using_2020; @biazin_rainwater_2012; @garrity_evergreen_2010]. Thus, in this system, there are considerable feedbacks between the condition of the environment, decisions made by farmers to clear and farm a forested area, and the state of the environment in future time periods. Further, as any one forested area is cleared, it opens new patches to potential clearing through frontier expansion. Hence, specific patches available in any one time period are highly dependent on social-ecological occurrences in previous time steps. Thus, this system displays both the feedbacks and path dependence characteristic of complex social-ecological systems. 


# 3 - Methods

## 3.1 - Data

### 3.1.1 - Land cover classification
We produced 20 m land cover maps using top of atmosphere Sentinel-2 time series imagery and ancillary datasets in a data fusion approach using Google Earth Engine (GEE) [@gorelick_google_2017; @mondal_evaluating_2019]. GEE is an open-access cloud computing platform that hosts petabytes of freely available earth observation data, and is ideal for creating land cover maps with built-in classification functions. For this study, we created annual median composite images for conversion into thematic land cover maps. We filtered the time series by date, and used the image metadata to further filter by estimated cloud cover, using a threshold of <20%. We then used the ‘QA60’ quality band to remove any remaining clouds prior to creating the composites of median values. Beyond the native Sentinel-2 spectral bands, we calculated common normalized difference indices useful for distinguishing common land cover types such as the Normalized Difference Vegetation Index (and red edge adaptations) and the Normalized Difference Water Index (NDWI) [@gao_ndwinormalized_1996] (as well as its modified version (MNDWI) [@defries_ndvi-derived_1994; @schuster_testing_2012; @xu_modification_2006]. We also used synthetic aperture radar (SAR) backscatter from the corresponding Sentinel-1 ground range detected time series available in GEE. We used SAR scenes from ascending paths only and incorporated both VV and VH polarizations in our analysis. SAR data are known to be influenced by varying incidence angles, so we normalized these images by multiplying the backscatter by the incidence angle with the understanding that greater incidence angles result in less backscatter returned to the instrument [@banks_wetland_2019; @kaplan_normalizing_2021]. To reduce inherent speckle in the SAR images, we opted for a time for space substitution by using a mean composite of all images for the given year to maintain a 10 m spatial resolution. Lastly, we considered topographic covariates for classification (elevation, slope, and aspect derived from the NASA Shuttle Radar Topography Mission digital elevation model) that dictate locations of land covers of interest relative to sea level and topography (Table S1) [@farr_shuttle_2007]. 

![Caption ](./PaperFigures/LandCoverMap.png)

From each composite image, we collected representative training samples for all classes of interest (mangrove, high forest, agriculture, urban, bare, coral rag, other woody vegetation, and water). We trained a random forest classifier using training samples from 2018, 2019, & 2021 to account for potentially varying atmospheric and illumination conditions among images [@breiman_random_2001]. The random forest we used for classification had 100 trees, and utilized four variables per split (the square root of the number of covariates), consistent with other remote sensing applications [@belgiu_random_2016]. Due to relative class imbalances, we chose to use a stratified random sampling design to assess the accuracy of our outputs, and computed area adjusted accuracy metrics [@olofsson_making_2013; @stehman_key_2019]. An expert hand labeled these stratified points based on high resolution median composite PlanetScope images with 20 points from each mapped class. Results show estimated overall accuracies of 92.86% (+/-4.21%) and 95.93% (+/- 2.95%) for 2018 and 2021, respectively (Table S2, Table S4). Much of the confusion and sources of error in the maps is found among upland woody vegetation classes (High forest, Mangrove, and Other woody vegetation) that share similar spectral and physical characteristics. Other mentionable errors occur among urban and agriculture in 2018, and bare and agriculture in 2021, leading to relatively high uncertainty for area estimates and producer’s accuracies in the rare urban and bare classes in 2018 and 2021, respectively (Table S3, Table S5). (GEE link)



### 3.1.1 - Interview data

In July 2021, we conducted informal interviews with staff of Community Forests Pemba, a nonprofit aimed at building conservation capacity on the island, and farmers in four shehia with coral rag forests in the east of the island. Researchers asked farmers about how they make decisions regarding when and how long to farm and fallow agricultural plots, as well as how they decide to clear forest vegetation to establish new cropland. There was broad consensus among non-profit staff and farmers that agricultural plots in these areas are typically farmed for two years and then left fallow for three years. Clearing forested land is labor intensive and thus, forested land is only cleared when nearby productive plots reach their two-year limit and no other previously-cleared adjacent plots are available.  

## 3.2 - Individual-based simulation

![Caption ](./PaperFigures/ABMABC_ConceptDiagram.png)

## 3.3 - Approximate Bayesian computation (ABC)

![Caption ](./PaperFigures/Prior.png)


# 4 - Results 
## 4.1 - Parameter estimation

![Caption ](./PaperFigures/EstimatesPixels.png)

![Caption ](./PaperFigures/Estimates.png)

## 4.2 - Estimating the contribution of each process

![Caption ](./PaperFigures/Contribution.png)

# 5 - Discussion

## 5.1 - Pemba specific implications

## 5.2 - Implications for land system science and SES

## 5.3 - Limitations and future work

# 6 - Conclusion

# 7- Acknowledgements
We thank the entire Community Forests Pemba staff for continued support on research in Pemba. We also thank the Hazards and Climate Resilience Institute at Boise State University for funding this research. Lastly, we thank the Max Planck Institute for Evolutionary Anthropology, department of Human Behavior, Ecology and Culture for providing the computing resources necessary for this project. 

# 8 - Open data and software

# Supplemental 1

ODD model description attached.

# Supplemental 2



# Supplemental 3



\newpage

# References
